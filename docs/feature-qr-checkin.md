# QR Check-in – Product Requirements Document (1-Day MVP)

---

## 1. Problem & Goal

Manual seat-code entry at the venue gate currently takes **10–15 s per guest**. We need a scan-based flow that:

- Works with the existing PayloadCMS collections and APIs
- Can be delivered in a single working day
- Keeps guests on our website to enable upsell banners and show-day information

## 2. Scope

### 2.1 MVP (Day-1)

| Included | Deferred / Extras |
| -------- | ---------------- |
| “My Ticket” email button linking to `/ticket/{TICKET_CODE}` | Signed / expiring QR payloads |
| Plain `ticketCode` payload (uppercase) encoded in QR | HMAC / JWT tokens, replay alerts |
| Camera scanner PWA at `/checkin/scan` (admin only) | Offline cache & replay queue |
| Uses existing APIs:<br>• `POST /validate/{TICKET_CODE}` → **maps to** `/api/checkin-app/validate/{TICKET_CODE}`<br>• `POST /checkin/{TICKET_CODE}` → **maps to** `/api/checkin-app/checkin/{TICKET_CODE}` | Bulk endpoints & dashboards |
| Full-screen green/red feedback with vibrate/beep | Wallet passes, seat-map heat-maps |
| Manual-entry fallback link | Progressive accessibility / language audits |

### 2.2 Out of Scope

Anything not explicitly listed above is excluded from Day-1.

## 3. User Stories

1. As a guest, I click **“My Ticket”** in the confirmation email and see my ticket details and QR code.  
2. As an usher, I open `/checkin/scan`, scan the guest’s QR code and immediately see a green success screen.  
3. As operations staff, I continue to use the existing history and delete flows with no changes.

## 4. Functional Requirements

### 4.1 Ticket Email

- Replace the embedded QR image with a **“My Ticket”** button:  
  `https://orchestars.com/ticket/{TICKET_CODE}`  
- Generated by the existing `SendMailButton` hook.

### 4.2 Ticket Page – `/ticket/[ticketCode]`

- Server-side rendered (SSR) route that fetches the ticket via the public Payload REST API.
- Displays event title, date, seat, attendee name and the QR code (generated with the `qrcode` library).
- Includes marketing slots for show-day info, merch banners and upcoming shows.

### 4.3 Scanner Page – `/checkin/scan`

- Accessible only to authenticated admins (`admin`, `super-admin`, `event-admin`).
- Uses `navigator.mediaDevices.getUserMedia()` + `jsQR` for camera scanning.
- Flow:  
  1. On decode, **POST** `/api/checkin-app/validate/{TICKET_CODE}`.  
  2. On **200 OK**, show ticket data and immediately **POST** `/api/checkin-app/checkin/{TICKET_CODE}`.  
  3. On validation failure (`409` / `4xx`), show a red screen with the error reason.
- UX: full-screen overlay; green for **1 s** then auto-ready; red for **2 s**.  
- **Manual Entry** button links to `/checkin/validates`.

### 4.4 Back-end Impact

- **None** – schemas, indexes and endpoints remain unchanged.

## 5. Non-Functional Requirements

| Item | Target |
| ---- | ------ |
| Scan-to-confirm latency | ≤ 2 s (network round-trip) |
| Supported devices | Mobile Chrome/Safari, laptop webcams |
| Accessibility | Min **4.5 : 1** contrast, vibration feedback |
| Security | HTTPS only; admin authentication required |

## 6. Infrastructure Assessment

The existing APIs, data models and authentication system already satisfy all MVP needs (see **`docs/qr-checkin-implementation-guide.md`** for a full analysis). No additional back-end work is required.

## 7. Implementation Plan (Estimated 6–8 h)

| Time | Task |
| ---- | ---- |
| 0–1 h | Install dependencies (`pnpm add qrcode jsqr @types/qrcode @types/jsqr`). Update email template with “My Ticket” button. |
| 1–3 h | Build `/ticket/[code]` page with QR render and marketing slots. |
| 3–6 h | Build `/checkin/scan`: camera hook, QR decode, API calls, overlay UI. |
| 6–7 h | Add feedback sounds/vibrate, manual fallback, copy polish. |
| 7–8 h | Cross-device testing (iOS, Android, laptop), deploy to staging, smoke test. |

## 8. Post-MVP Extras (Next Sprint)

- Signed QR payloads (HMAC).  
- Duplicate-scan alerts (`securityEvents` collection).  
- Offline cache for poor-wifi venues.  
- Wallet Pass generator.  
- Live seat heat-map widget on the admin dashboard.

## 9. Success Metrics

- Average gate processing time < 2 s.  
- Zero critical scanner bugs during first event.  
- ≥ 90 % usher satisfaction in retro survey.

---

*Last updated: 2025-07-10*